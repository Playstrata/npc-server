# 一個帳號一個角色限制功能

## 概述
每個用戶帳號只能創建一個角色，這樣的設計有以下優點：
- 簡化遊戲體驗，專注於單一角色成長
- 減少多開帳號的複雜度
- 增加角色選擇的重要性和決策權重

## 實作內容

### 1. 資料庫關係修改
- **User Entity**: 從 `OneToMany` 改為 `OneToOne` 關係
- **Character Entity**: 維持現有結構，業務邏輯層確保唯一性

### 2. 業務邏輯限制
- 角色創建前檢查用戶是否已有角色
- 提供友好的中文錯誤訊息
- 額外的角色名稱重複檢查

### 3. API 端點

#### 創建角色
```
POST /characters
```
- 檢查用戶是否已有角色
- 檢查角色名稱是否重複
- 返回詳細的錯誤訊息

#### 取得用戶角色
```
GET /characters
```
- 返回用戶的單一角色（如果存在）
- 如果沒有角色則返回 null

#### 檢查創建權限
```
GET /characters/can-create
```
- 檢查用戶是否可以創建角色
- 返回 boolean 值

## 錯誤訊息

### 用戶已有角色
```json
{
  "statusCode": 400,
  "message": "用戶已經有一個角色了，無法創建更多角色"
}
```

### 角色名稱重複
```json
{
  "statusCode": 400,
  "message": "角色名稱已被使用，請選擇其他名稱"
}
```

### 角色名稱驗證
```json
{
  "statusCode": 400,
  "message": ["角色名稱至少需要2個字符", "角色名稱最多50個字符"]
}
```

## 前端整合建議

### 1. 角色創建流程
1. 用戶註冊後檢查 `/characters/can-create`
2. 如果可以創建，顯示角色創建表單
3. 明確提示「一個帳號只能創建一個角色」
4. 提供角色預覽功能
5. 創建前的最終確認對話框

### 2. 用戶體驗優化
- 在角色創建頁面顯著提示限制
- 提供角色屬性重置功能（後期實作）
- 清楚的角色永久性說明

## 測試案例

### 正常流程
1. 新用戶可以創建第一個角色
2. 角色創建成功後無法再創建
3. 可以正常取得用戶的角色資訊

### 錯誤處理
1. 嘗試創建第二個角色時收到錯誤
2. 重複角色名稱時收到錯誤
3. 無效的角色名稱格式收到驗證錯誤

## 未來擴展

### 角色重置功能（可選）
- 提供特殊道具或服務重置角色
- 需要客服審核或特殊流程
- 保留角色歷史記錄

### 角色轉移功能（可選）
- 允許將角色轉移到另一個帳號
- 需要雙方確認和安全驗證
- 適用於帳號出售或轉讓場景

## 配置選項

未來可以考慮將「一個帳號一個角色」作為可配置選項：
- 伺服器管理員可以調整限制數量
- 不同伺服器可以有不同的政策
- VIP 用戶可能有不同的限制